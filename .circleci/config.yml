# Generated from CircleCI.pkl. DO NOT EDIT.
version: '2.1'
jobs:
  test:
    steps:
      - checkout
      - run:
          command: ./gradlew check
    docker:
      - image: cimg/openjdk:17.0
  publish-docs:
    steps:
      - checkout
      - run:
          command: ./gradlew generateAndPublishDocs
    docker:
      - image: cimg/openjdk:17.0
  trigger-docsite-build:
    steps:
      - run:
          command: |-
            curl --location \
              --request POST \
              --header "Content-Type: application/json" \
              -u "${CIRCLE_TOKEN}:" \
              --data '{ "branch": "main" }' \
              "https://circleci.com/api/v2/project/github/apple/pkl-lang.org/pipeline"
          name: Triggering docsite build
    docker:
      - image: cimg/base:current
workflows:
  prb:
    jobs:
      - test
    when:
      matches:
        value: << pipeline.git.branch >>
        pattern: ^pull/\d+(/head)?$
  main:
    jobs:
      - publish-docs:
          context:
            - pkl-github-release
      - trigger-docsite-build:
          requires:
            - publish-docs
    when:
      equal:
        - main
        - << pipeline.git.branch >>
